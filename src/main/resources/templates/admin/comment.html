<!DOCTYPE html>
<html xmlns:th="http://www.springframework.org/schema/mvc">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/my.css">
    <title>åå°ç®¡ç†</title>
</head>
<body>
<div id="app">
    <el-container style="height: 60px;">
        <!--LOGO-->
        <el-image style="width: 200px; height: 60px;" src="/img/logo.jpg"></el-image>
        <!--çŠ¶æ€æ -->
        <el-main style="background-color: #ffcccc">


            å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆæ¬¢è¿ğŸ‘

            <el-link style="float: right" href="https://element.eleme.io" target="_blank" :underline="false">
                <i class="el-icon-s-promotion"></i>åšå®¢é¦–é¡µ
            </el-link>

            <el-dropdown style="float: right;">
                <span class="el-dropdown-link" style="margin-right: 30px;"><i class="el-icon-s-custom"
                                                                              style="margin-right: 10px;"></i>é¼</span>
                <el-dropdown-menu slot="dropdown">
                    <el-dropdown-item disabled>æ˜µç§°ï¼š&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é¼</el-dropdown-item>
                    <el-dropdown-item disabled>è´¦å·ï¼š&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MonsterXu</el-dropdown-item>
                    <el-dropdown-item disabled>ä¸Šæ¬¡ç™»å½•ï¼š&nbsp;&nbsp;&nbsp;2020-07-19 17:00:29</el-dropdown-item>
                </el-dropdown-menu>
            </el-dropdown>
        </el-main>
    </el-container>

    <!--ä¸­é—´-->
    <el-container style="height: 765px; border: 1px solid #eee;">
        <!--å¯¼èˆªæ -->
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)">
            <el-menu
                    :default-openeds="['1','2','3']"
                    class="links">
                <!--åˆ†ç±»æ ‡é¢˜-->
                <el-submenu index="1">
                    <template slot="title"><i class="el-icon-stopwatch"></i>ä»ªè¡¨ç›˜</template>
                    <el-menu-item-group>
                        <a href="/admin">
                            <el-menu-item index="1-1"><i class="el-icon-stopwatch"></i>ä»ªè¡¨ç›˜</el-menu-item>
                        </a>
                        <a href="/admin/blog/showAddBlog">
                            <el-menu-item index="1-2"><i class="el-icon-edit-outline"></i>å‘å¸ƒåšå®¢</el-menu-item>
                        </a>
                    </el-menu-item-group>
                </el-submenu>

                <el-submenu index="2">
                    <template slot="title"><i class="el-icon-menu"></i>ç®¡ç†æ¨¡å—</template>
                    <el-menu-item-group>
                        <a href="/admin/blog">
                            <el-menu-item index="2-1"><i class="el-icon-notebook-1"></i>åšå®¢ç®¡ç†</el-menu-item>
                        </a>
                        <a href="/admin/comment">
                            <el-menu-item index="2-2"><i class="el-icon-chat-line-round"></i>è¯„è®ºç®¡ç†</el-menu-item>
                        </a>
                        <a href="/admin/category">
                            <el-menu-item index="2-3"><i class="el-icon-collection-tag"></i>åˆ†ç±»ç®¡ç†</el-menu-item>
                        </a>
                        <a href="/admin/tags">
                            <el-menu-item index="2-4"><i class="el-icon-price-tag"></i>æ ‡ç­¾ç®¡ç†</el-menu-item>
                        </a>
                        <a href="/admin/link">
                            <el-menu-item index="2-5"><i class="el-icon-link"></i>å‹æƒ…é“¾æ¥</el-menu-item>
                        </a>
                    </el-menu-item-group>
                </el-submenu>

                <el-submenu index="3">
                    <template slot="title"><i class="el-icon-s-tools"></i>ç³»ç»Ÿç®¡ç†</template>
                    <el-menu-item-group>
                        <a href="/admin/system">
                            <el-menu-item index="3-1"><i class="el-icon-setting"></i>ç³»ç»Ÿé…ç½®</el-menu-item>
                        </a>
                        <a href="/admin/user">
                            <el-menu-item index="3-2"><i class="el-icon-user"></i>ä¿®æ”¹å¯†ç </el-menu-item>
                        </a>
                        <a href="/admin/exit">
                            <el-menu-item index="3-3"><i class="el-icon-switch-button"></i>å®‰å…¨é€€å‡º</el-menu-item>
                        </a>
                    </el-menu-item-group>
                </el-submenu>
            </el-menu>
        </el-aside>

        <el-container>
            <el-header
                    style="width: 100%; background-color: #ffd6d6; height: 40px; line-height: 40px; font-size: 16px;">
                <b>åå°ç®¡ç†ä¸­å¿ƒ</b>
            </el-header>

            <!--å†…å®¹å±•ç¤º-->
            <div>
                <el-main>
                    <template>
                        <el-button size="small" type="primary" round @click="addTag()">æ‰¹é‡å®¡æ ¸</el-button>
                    </template>

                    <template>

                        <el-table style=" width: 100%" :data="comments">

                            <el-table-column
                                    type="selection"
                                    width="55">
                            </el-table-column>

                            <el-table-column prop="commentId" label="åºå·" width="80">
                            </el-table-column>

                            <el-table-column prop="commentBody" label="è¯„è®ºå†…å®¹" width="230">
                            </el-table-column>

                            <el-table-column prop="commentCreateTime" label="è¯„è®ºæ—¶é—´" width="120">
                            </el-table-column>

                            <el-table-column prop="commentator" label="è¯„è®ºäººåç§°" width="120">
                            </el-table-column>

                            <el-table-column prop="email" label="è¯„è®ºé‚®ç®±" width="160">
                            </el-table-column>

                            <el-table-column prop="commentStatus" label="çŠ¶æ€" width="80">
                                <template slot-scope="scope">
                                    <el-button type="primary" v-if="scope.row.commentStatus==1" size="mini"
                                               @click="checkOffStatus(scope.row)">å·²å®¡æ ¸
                                    </el-button>
                                    <el-button type="info" v-if="scope.row.commentStatus==0" size="mini"
                                               @click="checkOnStatus(scope.row)">æœªå®¡æ ¸
                                    </el-button>
                                </template>
                            </el-table-column>

                            <el-table-column prop="replyBody" label="å›å¤å†…å®¹" width="160">
                            </el-table-column>

                            <el-table-column prop="isDeleted" label="æ“ä½œ">
                                <template slot-scope="scope">
                                    <el-button size="mini" type="danger" @click="deleteComment(scope.row)">åˆ é™¤
                                    </el-button>

                                    <el-button size="mini" type="info" @click="replyComment(scope.row)">å›å¤
                                    </el-button>
                                </template>
                            </el-table-column>
                        </el-table>
                    </template>
                </el-main>
            </div>


            <!--åˆ†é¡µæ¡ï¼Œä¸€é¡µæ˜¾ç¤º11ä¸ªæœ€å¥½-->
            <div align="center">
                <el-pagination
                        background
                        layout="prev, pager, next"
                        @current-change="handleCurrentChange"
                        :total="pagination.total"
                        :page-size="pagination.pageSize"
                        :current-page.sync="pagination.currentPage">
                </el-pagination>
            </div>

        </el-container>


    </el-container>
    <!--åº•éƒ¨-->
    <el-container>
        <el-footer style="height:25px; line-height: 25px; text-align: center; font-size: 9px;">
            Copyright Â© 2020 MonsterXU All rights reserved. <i>äº¬ICPè¯110507å· äº¬ICPå¤‡10046444å· äº¬å…¬ç½‘å®‰å¤‡11010802020134å·
            äº¬ç½‘æ–‡[2020]0276-042å·</i>
        </el-footer>
    </el-container>
</div>
</body>
<!-- import Vue and Element -->
<script src="/js/vue.js"></script>
<script src="/js/ElementUI-index.js"></script>
<script src="/js/jquery.min.js"></script>
<script src="/js/axios.js"></script>
<script type="text/javascript" th:inline="javascript">
    new Vue({
        el: '#app',
        data() {
            comments = [[${comments}]];
            console.log(comments);

            //åˆ†é¡µç›¸å…³å±æ€§
            pagination = {
                currentPage: 1,
                pageSize: 10,
                total: 0,
            };

            return {
                comments,
                pagination
            };
        },
        //é’©å­å‡½æ•°
        created() {
            this.findPage();
        },
        methods: {
            //å›å¤è¯„è®º
            replyComment(comment) {
                this.$prompt('è¯·è¾“å›å¤å†…å®¹', 'å›å¤è¯„è®º', {
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                }).then(({value}) => {
                    //å‘é€è¯·æ±‚ï¼Œæ·»åŠ æ ‡ç­¾
                    axios.post("/admin/comment/reply/" + comment.commentId, {"replyBody":value}).then((res) => {
                        // console.log(res);
                        if (res.data.flag) {
                            //æ·»åŠ æˆåŠŸ
                            this.$message({
                                type: 'success',
                                message: 'å›å¤æ¶ˆæ¯æˆåŠŸï¼'
                            });
                        }
                        //ä¿®æ”¹æˆåŠŸä¹‹åé‡æ–°è°ƒç”¨åˆ†é¡µæŸ¥è¯¢
                        this.findPage();
                    }).catch((err) => {
                        //æ‰“å°é”™è¯¯ä¿¡æ¯
                        console.log(err);
                        //æ·»åŠ å¤±è´¥
                        this.$message({
                            type: 'error',
                            message: 'æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ ‡ç­¾æ˜¯å¦é‡å¤æˆ–è€…ç½‘ç»œæ˜¯å¦æœ‰é—®é¢˜'
                        });
                    });
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: 'å–æ¶ˆæ·»åŠ '
                    });
                });

            },
            //ä¿®æ”¹æ ‡ç­¾
            editTag(comment) {

                this.$prompt('è¯·è¾“æ ‡ç­¾åç§°', 'ä¿®æ”¹æ ‡ç­¾', {
                    inputValue: tag.tagName,
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                }).then(({value}) => {
                    //å‘é€è¯·æ±‚ï¼Œæ·»åŠ æ ‡ç­¾
                    axios.put("/admin/tags/update/" + tag.tagId + "/" + value,).then(res => {

                        console.log(res);
                        console.log("idæ˜¯ï¼š" + tag.tagId + "   åç§°æ˜¯ï¼š" + value + "  ä¿®æ”¹ä¹‹åçš„åç§°æ˜¯ï¼š" + value);
                        //åˆ¤æ–­æ˜¯å¦ä¿®æ”¹æˆåŠŸ
                        if (res.data.flag) {
                            this.$message({
                                type: 'success',
                                message: 'ä¿®æ”¹æ ‡ç­¾æˆåŠŸï¼Œä¿®æ”¹åçš„æ ‡ç­¾åç§°æ˜¯ï¼š ' + value
                            });

                            //ä¿®æ”¹æˆåŠŸä¹‹åé‡æ–°è°ƒç”¨åˆ†é¡µæŸ¥è¯¢
                            this.findPage();

                        }

                    }).catch(err => {
                        //ä¿®æ”¹å¤±è´¥
                        this.$message({
                            type: 'error',
                            message: 'æ ‡ç­¾ä¿®æ”¹å¤±è´¥'
                        });
                    })

                    //å–æ¶ˆä¿®æ”¹
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: 'å–æ¶ˆä¿®æ”¹'
                    });
                });

            },
            //å®¡æ ¸é€šè¿‡
            checkOnStatus(comment) {
                this.$confirm('æ˜¯å¦é€šè¿‡å®¡æ ¸?', 'å–æ¶ˆå®¡æ ¸', {
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'info'
                }).then(() => {
                    //å‘é€è¯·æ±‚å®¡æ ¸é€šè¿‡è¯„è®º
                    axios.put("/admin/comment/recover/" + comment.commentId).then((res) => {
                        if (res.data.flag) {
                            //æ¢å¤æˆåŠŸ
                            this.$message({
                                type: 'success',
                                message: 'å®¡æ ¸é€šè¿‡'
                            });
                            this.findPage();
                        }

                    }).catch((err) => {
                        console.log("å®¡æ ¸å¤±è´¥ï¼š " + err);
                        //åˆ é™¤å¤±è´¥
                        this.$message({
                            type: 'error',
                            message: 'å®¡æ ¸å¤±è´¥'
                        });
                    });
                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: 'å–æ¶ˆå®¡æ ¸'
                    });
                });

            },
            //å–æ¶ˆå®¡æ ¸
            checkOffStatus(comment) {
                this.$confirm('æ˜¯å¦å–æ¶ˆå®¡æ ¸?', 'å–æ¶ˆå®¡æ ¸', {
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'warning'
                }).then(() => {
                    //å‘é€è¯·æ±‚åœç”¨æ ‡ç­¾
                    axios.put("/admin/comment/stop/" + comment.commentId).then((res) => {

                        if (res.data.flag) {
                            //åœç”¨æˆåŠŸ
                            this.$message({
                                type: 'success',
                                message: 'åœç”¨æˆåŠŸ'
                            });
                            this.findPage();
                        }

                    }).catch((err) => {
                        //åœç”¨å¤±è´¥
                        this.$message({
                            type: 'error',
                            message: 'åœç”¨å¤±è´¥'
                        });
                    });

                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: 'å–æ¶ˆåœç”¨'
                    });
                });
            },
            //åˆ é™¤æ¶ˆæ¯å›å¤
            deleteComment(comment) {
                this.$confirm('æ˜¯å¦åˆ é™¤è¯¥è¯„è®º?', 'åˆ é™¤è¯„è®º', {
                    confirmButtonText: 'ç¡®å®š',
                    cancelButtonText: 'å–æ¶ˆ',
                    type: 'danger'
                }).then(() => {
                    //å‘é€è¯·æ±‚åˆ é™¤æ ‡ç­¾
                    axios.delete("/admin/comment/delete/" + comment.commentId).then((res) => {
                        if (res.data.flag) {
                            //åˆ é™¤æˆåŠŸ
                            this.$message({
                                type: 'success',
                                message: 'åˆ é™¤æˆåŠŸ'
                            });
                            this.findPage();
                        }
                    }).catch((err) => {
                        console.log("åˆ é™¤è¯„è®ºå¤±è´¥ï¼š " + err);
                        //åˆ é™¤å¤±è´¥
                        this.$message({
                            type: 'error',
                            message: 'åˆ é™¤å¤±è´¥'
                        });
                    });

                }).catch(() => {
                    this.$message({
                        type: 'info',
                        message: 'å–æ¶ˆåˆ é™¤'
                    });
                });
            },
            //åˆ†é¡µæŸ¥è¯¢
            findPage() {
                //å°è£…åˆ†é¡µå‚æ•°
                var currentPage = this.pagination.currentPage - 1;
                var pageSize = this.pagination.pageSize;

                console.log("currentPage:" + currentPage + "---------- currentPage" + currentPage);

                //å‘é€ajaxè¯·æ±‚ï¼Œæäº¤åˆ†é¡µç›¸å…³å‚æ•°
                axios.get("/admin/comment/findPage/" + currentPage + "/" + pageSize).then((res) => {

                    //console.log(res);

                    //ä¸ºVUEå¯¹è±¡çš„æ¨¡å‹æ•°æ®èµ‹å€¼ï¼ŒåŸºäºåŒå‘æ•°æ®ç»‘å®šå±•ç¤ºåˆ°é¡µé¢
                    this.comments = res.data.rows;//å½“å‰é¡µå±•ç¤ºçš„æ•°æ®é›†åˆ
                    this.pagination.total = res.data.total;//æ€»æ•°æ®é‡
                });
            },
            //åˆ‡æ¢é¡µç 
            handleCurrentChange(val) {
                console.log(val);
                //ä¸ºæ¨¡å‹æ•°æ®èµ‹å€¼ï¼ˆå½“å‰é¡µé¢ï¼‰
                this.pagination.currentPage = val;
                this.findPage();
            }

        }
    });
</script>

</html>